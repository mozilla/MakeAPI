/*
* $ lightbox_me
* By: Buck Wilson
* Version : 2.3
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

(function(a){a.fn.lightbox_me=function(b){return this.each(function(){function j(){var b=e[0].style;c.destroyOnClose?e.add(d).remove():e.add(d).hide(),c.parentLightbox&&c.parentLightbox.fadeIn(200),f.remove(),e.undelegate(c.closeSelector,"click"),a(window).unbind("reposition",l),a(window).unbind("reposition",m),a(window).unbind("scroll",m),a(window).unbind("keyup.lightbox_me"),g&&b.removeExpression("top"),c.onClose()}function k(a){(27==a.keyCode||27==a.DOM_VK_ESCAPE&&0==a.which)&&c.closeEsc&&j()}function l(){a(window).height()<a(document).height()?(d.css({height:a(document).height()+"px"}),f.css({height:a(document).height()+"px"})):(d.css({height:"100%"}),g&&(a("html,body").css("height","100%"),f.css("height","100%")))}function m(){var b=e[0].style;if(e.css({left:"50%",marginLeft:-1*(e.outerWidth()/2),zIndex:c.zIndex+3}),e.height()+80>=a(window).height()&&("absolute"!=e.css("position")||g)){var d=a(document).scrollTop()+40;e.css({position:"absolute",top:d+"px",marginTop:0}),g&&b.removeExpression("top")}else if(e.height()+80<a(window).height())if(g)if(b.position="absolute",c.centered)b.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),b.marginTop=0;else{var f=c.modalCSS&&c.modalCSS.top?parseInt(c.modalCSS.top):0;b.setExpression("top","((blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+f+') + "px"')}else c.centered?e.css({position:"fixed",top:"50%",marginTop:-1*(e.outerHeight()/2)}):e.css({position:"fixed"}).css(c.modalCSS)}var c=a.extend({},a.fn.lightbox_me.defaults,b),d=a(),e=a(this),f=a('<iframe id="foo" style="z-index: '+(c.zIndex+1)+';border: none; margin: 0; padding: 0; position: absolute; width: 100%; height: 100%; top: 0; left: 0; filter: mask();"/>'),g=a.browser.msie&&7>a.browser.version;if(c.showOverlay){var h=a(".js_lb_overlay:visible");d=h.length>0?a('<div class="lb_overlay_clear js_lb_overlay"/>'):a('<div class="'+c.classPrefix+'_overlay js_lb_overlay"/>')}if(g){var i=/^https/i.test(window.location.href||"")?"javascript:false":"about:blank";f.attr("src",i),a("body").append(f)}a("body").append(e.hide()).append(d),c.showOverlay&&(l(),d.css({position:"absolute",width:"100%",top:0,left:0,right:0,bottom:0,zIndex:c.zIndex+2,display:"none"}),d.hasClass("lb_overlay_clear")||d.css(c.overlayCSS)),c.showOverlay?d.fadeIn(c.overlaySpeed,function(){m(),e[c.appearEffect](c.lightboxSpeed,function(){l(),m(),c.onLoad()})}):(m(),e[c.appearEffect](c.lightboxSpeed,function(){c.onLoad()})),c.parentLightbox&&c.parentLightbox.fadeOut(200),a(window).resize(l).resize(m).scroll(m),a(window).bind("keyup.lightbox_me",k),c.closeClick&&d.click(function(a){j(),a.preventDefault}),e.delegate(c.closeSelector,"click",function(a){j(),a.preventDefault()}),e.bind("close",j),e.bind("reposition",m)})},a.fn.lightbox_me.defaults={appearEffect:"fadeIn",appearEase:"",overlaySpeed:250,lightboxSpeed:300,closeSelector:".close",closeClick:!0,closeEsc:!0,destroyOnClose:!1,showOverlay:!0,parentLightbox:!1,onLoad:function(){},onClose:function(){},classPrefix:"lb",zIndex:999,centered:!1,modalCSS:{top:"40px"},overlayCSS:{background:"black",opacity:.3}}})(jQuery);
